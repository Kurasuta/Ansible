- name: install dependencies
  apt: name={{ item }} state=present
  with_items:
    - git
    - upx-ucl
    - p7zip
    - ssdeep
    - libffi-dev
    - libssl-dev
    - build-essential
    - python3
    - python3-dev
    - python3-pip
    - python3-ssdeep
    - automake
    - autoconf
    - libtool

- name: create user
  user: name=worker

- name: create directory
  file: path=/opt/Worker state=directory owner=worker group=worker

- name: clone git repo
  become_user: worker
  git: repo=https://github.com/Kurasuta/Worker.git dest=/opt/Worker

- name: create virtualenv and install dependencies
  become_user: worker
  pip:
    name: "{{ item }}"
    virtualenv: /opt/Worker/.venv
    virtualenv_python: python3
  with_items:
    - pefile
    - raven

- name: install dependencies ssdeep Python bindings
  become_user: worker
  pip:
    name: "{{ item }}"
    virtualenv: /opt/Worker/.venv
    virtualenv_python: python3
  with_items:
    - ssdeep
  environment:
    BUILD_LIB: '1'
